"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2712],{45739:(e,t,a)=>{a.d(t,{R:()=>s,x:()=>o});var i=a(96363);const r={},n=i.createContext(r);function s(e){const t=i.useContext(n);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(n.Provider,{value:t},e.children)}},48725:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"sheet/help/large-data","title":"Large Data","description":"Reading","source":"@site/docs/sheet/help/large-data.md","sourceDirName":"sheet/help","slug":"/sheet/help/large-data","permalink":"/docs/sheet/help/large-data","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/fesod/edit/main/website/docs/sheet/help/large-data.md","tags":[],"version":"current","frontMatter":{"id":"large-data","title":"Large Data"},"sidebar":"docs","previous":{"title":"Parameter","permalink":"/docs/sheet/help/parameter"},"next":{"title":"FAQ","permalink":"/docs/sheet/help/faq"}}');var r=a(47259),n=a(45739);const s={id:"large-data",title:"Large Data"},o="Big Data Files",l={},d=[{value:"Reading",id:"reading",level:2},{value:"Overview",id:"overview",level:3},{value:"Default Policy",id:"default-policy",level:3},{value:"Configure Memory",id:"configure-memory",level:3},{value:"About maxCacheActivateSize",id:"about-maxcacheactivatesize",level:3}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"big-data-files",children:"Big Data Files"})}),"\n",(0,r.jsx)(t.h2,{id:"reading",children:"Reading"}),"\n",(0,r.jsx)(t.h3,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(t.p,{children:["When reading files larger than 10 MB, Microsoft Excel 03 is unable to handle them and consumes significantly more\nmemory. Microsoft Excel 2007 introduces the concept\nof ",(0,r.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/office/open-xml/spreadsheet/working-with-the-shared-string-table",children:"Shared Strings"}),",\nwhich can consume a significant amount of memory.\nIf all shared strings are loaded into memory, the memory usage can be approximately 3 to 10 times the size of the spreadsheet\nfile. Therefore, FesodSheet uses a strategy of first storing the file and then deserialising it to read the data,\nthereby\nsaving memory. Of course, after deserialising the file, efficiency will decrease by approximately 30-50% (this is not\nfixed and depends on the hit rate, which may exceed 100%)."]}),"\n",(0,r.jsx)(t.p,{children:"If the read efficiency is acceptable, use the default setting. The permanent memory usage (for the entire process of\nreading a single spreadsheet file) generally does not exceed 50MB (most likely around 30MB), and the remaining temporary\nmemory is quickly recycled by the garbage collector."}),"\n",(0,r.jsx)(t.h3,{id:"default-policy",children:"Default Policy"}),"\n",(0,r.jsx)(t.p,{children:"By default, large file processing is automatically determined. Shared strings under 5M are stored in memory, which\noccupies approximately 15-50M of memory. Strings over 5M are stored in files, and file storage also requires additional\nmemory to store temporary shared strings, with a default of 20M. Apart from the memory used by shared strings, other\nmemory usage is minimal, so it can be estimated at 10MB. Therefore, the default of approximately 30MB is sufficient to\nread an extremely large file."}),"\n",(0,r.jsx)(t.h3,{id:"configure-memory",children:"Configure Memory"}),"\n",(0,r.jsx)(t.p,{children:"If you want to customise the settings, first determine how much memory you are willing to allocate for reading a very\nlarge spreadsheet file.\nFor example, if you want the spreadsheet file to occupy a maximum of 100MB of memory during the reading process (this is the\npermanent memory usage during reading, not including memory immediately reclaimed by the young generation), then set the\nsize of the shared string stored in the file to 20MB (less than 20MB is stored in memory, more than 20MB is stored in a\ntemporary file), and then set the memory size occupied by the temporary shared string when stored in the file to\napproximately 90MB."}),"\n",(0,r.jsx)(t.p,{children:"If the maximum number of file entries is only a few hundred thousand, and the spreadsheet file is only a few dozen megabytes,\nand there is no high concurrency, and memory is sufficient,"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"// Force memory storage, so a 20M spreadsheet file will use 150M of memory (many temporary objects, so 100M will be constantly GC'd).\n// This will be much more efficient than the complex strategy above.\n// Just to clarify, all I did was add the readCache(new MapCache()) parameter. For the rest, refer to other examples.\nFesodSheet.read().\n\nreadCache(new MapCache());\n"})}),"\n",(0,r.jsx)(t.p,{children:"High concurrency requirements, and often involve extremely large files."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"// The first parameter specifies how many MB of shared string data will be stored in the file (default is 5 MB).\n// The second parameter specifies how many MB of cache data will be stored in memory when using file storage (default is 20 MB).\n// For example, if you want to use 100 MB of memory (this refers to permanent memory usage during parsing, excluding temporary objects) to parse a spreadsheet file, the calculation shows it to be approximately 20 MB + 90 MB, so set the parameters to: 20 and 90.\n// Here's a clarification: the only addition is the readCacheSelector(new SimpleReadCacheSelector(5, 20)) parameter; the rest follows the examples provided.\nFesodSheet.read().\n\nreadCacheSelector(new SimpleReadCacheSelector(5, 20));\n"})}),"\n",(0,r.jsx)(t.h3,{id:"about-maxcacheactivatesize",children:"About maxCacheActivateSize"}),"\n",(0,r.jsxs)(t.p,{children:["When using file storage, FesodSheet splits the shared string into batches of ",(0,r.jsx)(t.strong,{children:"1000"})," items and then stores them in file\nstorage. Spreadsheets typically read shared strings in sequential order, so by default, 1000 entries (approximately 20MB) are\nkept in memory. If a match is found, the data is returned directly; if not, the file is read. Therefore, the size should\nnot be set too small, as this makes it difficult to find a match and results in constant file reads. Conversely, setting\nit too large can consume excessive memory."]}),"\n",(0,r.jsxs)(t.p,{children:["To determine whether ",(0,r.jsx)(t.code,{children:"maxCacheActivateSize"})," needs adjustment, enabling ",(0,r.jsx)(t.code,{children:"debug"})," logs will output ",(0,r.jsx)(t.code,{children:"Already put :4000000"}),"\nas the last value, which can be estimated to be 4 million. Then, checking ",(0,r.jsx)(t.code,{children:"Cache misses count:4001"})," yields a value of\n4,000. ",(0,r.jsx)(t.code,{children:"4 million / 4,000 = 1,000"})," indicates that ",(0,r.jsx)(t.code,{children:"maxCacheActivateSize"})," is already very reasonable. If the value is\nless than 500, there is a significant issue. Values between 500 and 1000 should be acceptable."]})]})}function c(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);